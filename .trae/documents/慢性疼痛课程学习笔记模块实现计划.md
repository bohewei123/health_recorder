## 目标与边界
- 新增“慢性疼痛管理课程学习笔记”模块：Markdown 编辑 + 笔记管理 + 本地存储 + 导出 Markdown。
- 本模块按你的要求“本地存储所有笔记数据”，不新增后端 API；导出由前端生成下载文件。

## 现状调研结论（用于对齐实现方式）
- 前端：React + Vite + Ant Design + Redux Toolkit + React Router（见现有页面与布局）。
- 后端：FastAPI + SQLite；当前已有“训练导出 Markdown”接口，但笔记模块要求本地存储，因此不复用后端。
- 当前未实现暗黑/明亮主题切换：Antd token 与背景色是固定写死的，需要补齐主题状态与 UI 切换入口。

## 前端功能设计
### 1) Markdown 编辑器（编辑 + 实时预览 + 工具栏）
- 新增页面 `/pain-notes`：左右分栏（桌面端）或 Tab 切换（移动端）显示“编辑/预览”。
- 编辑区：`Input.TextArea` 或原生 `textarea`（保留 selection 操作方便），支持输入基本 Markdown。
- 工具栏：加粗、斜体、标题（H1/H2/H3）、无序/有序列表、链接、代码块；按钮通过“在光标处插入/包裹选中文本”的方式实现。
- 实时预览：引入 Markdown 解析库将 Markdown 转 HTML，并进行 XSS 安全净化后渲染；预览区配套 Markdown 样式（标题、列表、代码块、链接）。

### 2) 笔记管理（时间、排序、筛选、长度限制、自动保存）
- 数据模型（本地）：
  - `id`（uuid）
  - `content`（Markdown 字符串，<=2000 字符）
  - `createdAt`、`updatedAt`（ISO 时间）
- 列表视图：按日期（默认 `updatedAt` 倒序）展示；每条显示日期 + 摘要（取前 N 字符并去掉 Markdown 标记的简化版本）。
- 日期范围筛选：使用 Antd `DatePicker.RangePicker` 基于 `createdAt`（或可切换到 `updatedAt`，以文档说明）过滤。
- 长度限制：编辑器设置 `maxLength=2000` + 超限校验（阻止保存/提示剩余字数）。
- 自动保存：
  - 30 秒定时保存“当前正在编辑且有改动”的笔记。
  - 失去焦点（编辑器 blur / window blur / visibilitychange）立即保存。

### 3) UI 与响应式（含主题切换）
- 在现有 `MainLayout` 菜单新增入口“课程笔记”。
- 响应式：
  - 桌面：列表（左）+ 编辑/预览（右）或列表上方；
  - 移动：列表页与编辑页用 Drawer/路由/Tab 简化交互，避免横向拥挤。
- 主题切换：
  - 新增全局 theme 状态（light/dark）并持久化到 localStorage。
  - `ConfigProvider` 根据 theme 切换 Antd algorithm（亮/暗）并调整 token。
  - 同步修正全局背景色与页面容器颜色，确保暗色模式下可读。

### 4) 数据导出（Markdown）
- 提供“导出”按钮：导出当前筛选范围内的笔记为一个 `.md` 文件（Blob 下载）。
- 导出格式建议：
  - 文件头包含导出时间与筛选范围；
  - 每篇笔记以 `# YYYY-MM-DD` 或 `# Note <date>` 开头，附 `createdAt/updatedAt`，并用 `---` 分隔。

## 技术实现落点（文件级）
- 路由：在 [App.jsx](file:///Users/zhilinyang/Desktop/health_recorder/frontend/src/App.jsx) 增加 `/pain-notes`。
- 导航：在 [MainLayout.jsx](file:///Users/zhilinyang/Desktop/health_recorder/frontend/src/components/MainLayout.jsx) 增加菜单项与顶部主题切换控件。
- 页面：新增 `frontend/src/pages/PainNotes.jsx`（列表 + 编辑器 + 预览）。
- 状态管理：新增 `frontend/src/store/painNotesSlice.js`（CRUD、过滤、选择当前笔记、dirty 标记）。
- 本地持久化：新增 `frontend/src/store/persistence.js` 或在 slice 内封装 localStorage 读写（含版本号 key 与容错）。
- 主题：新增 `frontend/src/store/themeSlice.js` 并接入 [frontend/src/store/index.js](file:///Users/zhilinyang/Desktop/health_recorder/frontend/src/store/index.js)；修改 [App.jsx](file:///Users/zhilinyang/Desktop/health_recorder/frontend/src/App.jsx) 的 `ConfigProvider` theme。
- 样式：在 `frontend/src/index.css`（或新增 CSS）补充 Markdown 渲染样式与暗色适配。

## 依赖策略
- 当前项目未引入 Markdown 渲染库；为保证“标题/列表/链接/代码块”等兼容性，计划新增：
  - Markdown 解析库（如 `marked` 或 `markdown-it`）
  - HTML 安全净化（如 `dompurify`）
- 若你希望“零新增依赖”，也可改为自实现极简 Markdown 子集渲染，但功能与兼容性会明显弱。

## 验证方式
- 前端：
  - 路由可访问、创建/编辑/删除/筛选/导出可用。
  - 自动保存（30s 与失焦）在刷新后仍保留。
  - 字数限制严格生效（粘贴/输入都不超 2000）。
  - 暗黑/明亮切换对全站生效并持久化。
- 构建校验：运行前端 lint/build（以项目现有脚本为准）。

## 文档更新（按你的“特别注意”要求）
- [README.md](file:///Users/zhilinyang/Desktop/health_recorder/README.md)：新增“课程笔记模块”与“主题切换/本地存储/导出”的功能说明。
- [DESIGN.md](file:///Users/zhilinyang/Desktop/health_recorder/DESIGN.md)：补充该模块的前端结构、数据模型、本地持久化与导出设计。
- [API_DOCS.md](file:///Users/zhilinyang/Desktop/health_recorder/API_DOCS.md)：明确“课程笔记模块不新增后端 API（本地存储）”，避免读者误以为有接口。

如果你确认这个计划，我将按以上步骤开始实际编码、集成依赖、完成验证，并在结束时同步更新上述文档。